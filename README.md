# FPLInsights

FPLInsights is a Python project for simulating, analyzing, and predicting Fantasy Premier League outcomes.
It combines structured statistical models (Monte Carlo simulation, probabilistic scoring, trend tracking)
with AI-assisted reasoning for transfers, captaincy, Free Hit squads, and H2H matchups.

## Features

### Core Engine (no AI required)
- Local SQLite storage for players, fixtures, player history, and team snapshots.
- Update pipeline that fetches all relevant FPL API data.
- Player-level prediction models (expected points, variance).
- Team-level prediction models.
- Monte Carlo engine capable of producing expected/median/p25/p75/p90 score distributions.

### AI Modules (optional)
All AI tools use only your local dataset. No external FPL API calls occur during AI analysis.

- AI Transfer Advisor  
  Evaluates squad info, fixtures, player form, rotation risk, budget logic, free transfers, allowed hits,
  and recommends realistic transfers within strict FPL rules.

- AI Captaincy Advisor  
  Analyzes recent form, nailedness, explosiveness, and rotation patterns to select optimal captain and vice-captain.

- AI Free Hit Builder #not fully refined yet
  Attempts to generate a full 15-man Free Hit squad within budget while respecting:
  - max 3 players per club
  - positional constraints
  - fixture difficulty
  - player form and minutes

- AI H2H Predictor  #not fully refined yet
  Compares two teams, uses season history, last-GW data, and optional Monte Carlo baselines
  to estimate expected points and win probabilities.

## Documentation

Documentation is located in the `docs/` directory:

- overview.md — high-level description  
- basic.md — simple prediction concepts  
- advanced.md — fixture-aware logic and deeper evaluation  
- architecture.md — internal module structure  
- api.md — CLI usage  
- roadmap.md — planned improvements

### AI Documentation (`docs/ai/`)
- ai_captaincy.md  
- ai_transfers.md  
- ai_freehit.md  
- ai_h2h.md  

These files document input formats, JSON outputs, prompts, assumptions, and usage examples.

## Environment Setup

Create a `.env` file in the project root:

OPENAI_API_KEY=your_key_here

The AI tools require this.  
The statistical engine (Monte Carlo, analytics) does NOT require an API key.

## Usage

### Update local FPL data
python update_fpl.py

### Before AI

The data required for AI modules is generated by running:

    python team_stats.py --entry <id>

This script queries the official FPL API for the manager’s season history, merges it with local SQLite per-player GW statistics, and outputs a fully structured `team_stats.json` file.

It also generates `rank_progression.png`, a visual chart showing the manager’s overall rank movement across all gameweeks.


### Captaincy advice
python ai.py captaincy --team <entry_id> --gw <gw>

### Transfer advice
Supports specifying free transfers and allowed extra transfers (each extra costs -4):
python ai.py transfers --team <entry_id> --gw <gw> --ft 2 --extra 1

### Free Hit builder
python ai.py freehit --gw <gw> --budget <value> --pool <candidate_count>

### H2H prediction
python ai.py h2h --teamA <id> --teamB <id> --gw <gw>

With Monte Carlo baseline:
python ai.py h2h --teamA <id> --teamB <id> --gw <gw> --mc

## Notes

FPLInsights is designed for extensibility.  
Future improvements include Poisson-based scoring, improved xMins modeling, autosubs simulation,
and deeper fixture-aware expected value calculations.

Contact: jankovicsrb@gmail.com
